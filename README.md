# H·ªÜ TH·ªêNG QU·∫¢N L√ù NGU·ªíN G·ªêC XU·∫§T X·ª® THU·ªêC T·∫†I B·ªÜNH VI·ªÜN B·∫∞NG BLOCKCHAIN

## T·ªïng quan
H·ªá th·ªëng ƒë∆∞·ª£c ph√°t tri·ªÉn ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ nghi√™m tr·ªçng v·ªÅ thu·ªëc gi·∫£ v√† thu·ªëc k√©m ch·∫•t l∆∞·ª£ng t·∫°i Vi·ªát Nam th√¥ng qua c√¥ng ngh·ªá blockchain.

## üìö T√†i Li·ªáu

### üöÄ C√†i ƒê·∫∑t & Setup
- ‚ö° **[SETUP_QUICK.md](./SETUP_QUICK.md)** - Setup nhanh trong 5 ph√∫t
- üì¶ **[INSTALLATION_GUIDE.md](./INSTALLATION_GUIDE.md)** - H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t ho√†n ch·ªânh (bao g·ªìm Firebase)
- üî• **[FIREBASE_COMPLETE_SETUP.md](./FIREBASE_COMPLETE_SETUP.md)** - Setup Firebase Authentication chi ti·∫øt
- üìã **[DOCUMENTATION_INDEX.md](./DOCUMENTATION_INDEX.md)** - M·ª•c l·ª•c t·∫•t c·∫£ t√†i li·ªáu

### üìñ T√†i Li·ªáu Kh√°c
- üìã **[TONG_HOP_DU_AN_DA_LAM.md](./TONG_HOP_DU_AN_DA_LAM.md)** - T·ªïng h·ª£p t·∫•t c·∫£ c√°c ph·∫ßn ƒë√£ l√†m c·ªßa d·ª± √°n ‚≠ê NEW
- üìò **H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng chi ti·∫øt giao di·ªán h·ªá th·ªëng**: xem file `HUONG_DAN_SU_DUNG.md`
- ‚öôÔ∏è **H∆∞·ªõng d·∫´n nhanh tri·ªÉn khai & deploy smart contract**: xem file `QUICK_START_BLOCKCHAIN.md`
- üß† **M√¥ t·∫£ ki·∫øn tr√∫c & nghi·ªáp v·ª• h·ªá th·ªëng**: xem file `MO_TA_HE_THONG.md`
- üì• **[IMPORT_GUIDE.md](./IMPORT_GUIDE.md)** - H∆∞·ªõng d·∫´n import d·ªØ li·ªáu t·ª´ PDF/CSV/Excel
- üí≥ **[MOMO_PAYMENT_SETUP.md](./MOMO_PAYMENT_SETUP.md)** - H∆∞·ªõng d·∫´n c·∫•u h√¨nh thanh to√°n MoMo ‚≠ê NEW
- ‚ö° **[MOMO_QUICK_START.md](./MOMO_QUICK_START.md)** - H∆∞·ªõng d·∫´n nhanh c·∫•u h√¨nh MoMo (5 ph√∫t) ‚≠ê NEW

## T√≠nh nƒÉng ch√≠nh

### Core Features
- ‚úÖ **Qu·∫£n l√Ω t√†i kho·∫£n ng∆∞·ªùi d√πng** v·ªõi ph√¢n quy·ªÅn r√µ r√†ng (Admin, Manufacturer, Distributor, Hospital, Patient)
- ‚úÖ **X√°c th·ª±c v√† b·∫£o m·∫≠t** v·ªõi JWT v√† bcrypt
- ‚úÖ **Firebase Authentication** - ƒêƒÉng nh·∫≠p Google ‚≠ê NEW
- ‚úÖ **API RESTful** ƒë·∫ßy ƒë·ªß cho t·∫•t c·∫£ modules
- ‚úÖ **Qu·∫£n l√Ω l√¥ thu·ªëc** v·ªõi blockchain integration
- ‚úÖ **Theo d√µi chu·ªói cung ·ª©ng** real-time
- ‚úÖ **Ch·ªØ k√Ω s·ªë** theo chu·∫©n Vi·ªát Nam (VNCA) v·ªõi Timestamp Authority
- ‚úÖ **H·ªá th·ªëng ƒëi·ªÉm t√≠n nhi·ªám** (Trust Score) cho nh√† cung ·ª©ng
- ‚úÖ **ƒê√°nh gi√° v√† x·∫øp h·∫°ng** (Reviews & Ratings)
- ‚úÖ **Qu·∫£n l√Ω nhi·ªám v·ª•** (Tasks Management)
- ‚úÖ **Th√¥ng b√°o** (Notifications)
- ‚úÖ **B√°o c√°o v√† ph√¢n t√≠ch** (Reports & Analytics)
- ‚úÖ **Qu√©t m√£ QR** ƒë·ªÉ tra c·ª©u ngu·ªìn g·ªëc thu·ªëc
- ‚úÖ **Frontend React** v·ªõi UI/UX hi·ªán ƒë·∫°i, responsive
- ‚úÖ **Blockchain Integration** v·ªõi Smart Contracts

## C·∫•u tr√∫c d·ª± √°n
```
DACN/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ User.js                 # User model v·ªõi ph√¢n quy·ªÅn
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ authController.js       # X·ª≠ l√Ω authentication
‚îÇ   ‚îî‚îÄ‚îÄ userController.js       # X·ª≠ l√Ω user management
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js                 # Authentication & authorization
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.js                 # Auth routes
‚îÇ   ‚îî‚îÄ‚îÄ users.js                # User management routes
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ validation.js           # Input validation
‚îú‚îÄ‚îÄ server.js                   # Main server file
‚îú‚îÄ‚îÄ package.json                # Dependencies
‚îî‚îÄ‚îÄ env.example                 # Environment variables template
```

## C√†i ƒë·∫∑t v√† ch·∫°y

### ‚ö° Quick Start (5 ph√∫t)

Xem file **[SETUP_QUICK.md](./SETUP_QUICK.md)** ƒë·ªÉ setup nhanh.

### üì¶ C√†i ƒê·∫∑t Chi Ti·∫øt

Xem file **[INSTALLATION_GUIDE.md](./INSTALLATION_GUIDE.md)** ƒë·ªÉ c√≥ h∆∞·ªõng d·∫´n c√†i ƒë·∫∑t ho√†n ch·ªânh, bao g·ªìm:
- C√†i ƒë·∫∑t dependencies
- C·∫•u h√¨nh MongoDB
- **C·∫•u h√¨nh Firebase Authentication (Google Login)**
- C·∫•u h√¨nh environment variables
- Test v√† troubleshooting

### T√≥m T·∫Øt Nhanh

```bash
# 1. C√†i ƒë·∫∑t
npm install
cd frontend && npm install && cd ..

# 2. C·∫•u h√¨nh
cp env.example .env
# Ch·ªânh s·ª≠a .env v·ªõi th√¥ng tin c·ªßa b·∫°n

# 3. Setup Firebase (xem INSTALLATION_GUIDE.md)

# 4. Start MongoDB
# Windows: net start MongoDB
# Mac/Linux: sudo systemctl start mongod

# 5. Ch·∫°y
npm run dev          # Terminal 1: Backend
cd frontend && npm start  # Terminal 2: Frontend
```

Server s·∫Ω ch·∫°y t·∫°i: `http://localhost:5000`  
Frontend s·∫Ω ch·∫°y t·∫°i: `http://localhost:3000`

### 5. H∆∞·ªõng d·∫´n deploy nhanh Dev/Prod

- **M√¥i tr∆∞·ªùng Development (demo, localhost)**  
  - Backend: ch·∫°y b·∫±ng `npm run dev` (ho·∫∑c `npm start`), MongoDB local, blockchain c√≥ th·ªÉ ·ªü **mock mode** n·∫øu ch∆∞a c·∫•u h√¨nh Infura/private key.  
  - Frontend: v√†o th∆∞ m·ª•c `frontend` v√† ch·∫°y `npm start`, c·∫•u h√¨nh `REACT_APP_API_URL` n·∫øu c·∫ßn truy c·∫≠p backend t·ª´ m√°y kh√°c trong LAN.

- **M√¥i tr∆∞·ªùng Production ƒë∆°n gi·∫£n (1 server)**  
  1. C√†i Node.js (>=16), MongoDB tr√™n server.  
  2. Copy m√£ ngu·ªìn, ch·∫°y `npm install` ·ªü th∆∞ m·ª•c g·ªëc v√† `npm install` trong `frontend`.  
  3. C·∫•u h√¨nh file `.env` v·ªõi c√°c bi·∫øn:
     - Th√¥ng tin MongoDB, JWT, PORT, `NODE_ENV=production`
     - Th√¥ng tin blockchain: `BLOCKCHAIN_NETWORK`, `INFURA_PROJECT_ID`, `PRIVATE_KEY` (ho·∫∑c `MNEMONIC`)
     - C·∫•u h√¨nh HSM (n·∫øu d√πng) trong `config/hsmConfig.js`
  4. Build frontend: `cd frontend && npm run build`, sau ƒë√≥ c·∫•u h√¨nh web server (Nginx/Apache) tr·ªè v√†o th∆∞ m·ª•c `frontend/build`.  
  5. Ch·∫°y backend b·∫±ng process manager (PM2, systemd‚Ä¶) v·ªõi l·ªánh `node server.js`.  
  6. Ki·ªÉm tra:
     - `http://<server>:5000/api/health` tr·∫£ v·ªÅ `success: true`
     - Giao di·ªán React truy c·∫≠p ƒë∆∞·ª£c backend qua `REACT_APP_API_URL`.

## API Endpoints

### Authentication
- `POST /api/auth/login` - ƒêƒÉng nh·∫≠p (email/password)
- `POST /api/auth/firebase` - ƒêƒÉng nh·∫≠p b·∫±ng Firebase (Google) ‚≠ê NEW
- `GET /api/auth/google` - ƒêƒÉng nh·∫≠p b·∫±ng Google OAuth (Passport.js)
- `POST /api/auth/register` - ƒêƒÉng k√Ω (Admin only)
- `PUT /api/auth/change-password` - ƒê·ªïi m·∫≠t kh·∫©u
- `PUT /api/auth/first-change-password` - ƒê·ªïi m·∫≠t kh·∫©u l·∫ßn ƒë·∫ßu
- `GET /api/auth/me` - L·∫•y th√¥ng tin user hi·ªán t·∫°i
- `PUT /api/auth/update-profile` - C·∫≠p nh·∫≠t profile
- `POST /api/auth/logout` - ƒêƒÉng xu·∫•t

### User Management
- `GET /api/users` - L·∫•y danh s√°ch users (Admin only)
- `GET /api/users/stats` - Th·ªëng k√™ users (Admin only)
- `GET /api/users/:id` - L·∫•y th√¥ng tin user theo ID
- `PUT /api/users/:id` - C·∫≠p nh·∫≠t user
- `DELETE /api/users/:id` - X√≥a user (Admin only)
- `PUT /api/users/:id/toggle-lock` - Kh√≥a/m·ªü kh√≥a user (Admin only)
- `PUT /api/users/:id/reset-password` - Reset m·∫≠t kh·∫©u (Admin only)

### Utility
- `GET /api/health` - Health check
- `GET /api` - API documentation

### API Documentation m·ªü r·ªông
- Backend cung c·∫•p endpoint t√†i li·ªáu API t·ªïng quan t·∫°i: `GET /api` (li·ªát k√™ c√°c nh√≥m endpoint ch√≠nh).  
- C√≥ th·ªÉ import t·∫≠p request t·ª´ Postman/REST Client d·ª±a tr√™n c√°c endpoint li·ªát k√™ ·ªü m·ª•c n√†y.  
- Khi tri·ªÉn khai production, khuy·∫øn ngh·ªã b·ªï sung file Postman Collection ho·∫∑c t√†i li·ªáu OpenAPI cho t·ª´ng m√¥i tr∆∞·ªùng.

## Vai tr√≤ ng∆∞·ªùi d√πng

### 1. Admin
- Qu·∫£n l√Ω to√†n b·ªô h·ªá th·ªëng
- T·∫°o/x√≥a/s·ª≠a t√†i kho·∫£n users
- Xem th·ªëng k√™ v√† b√°o c√°o
- Reset m·∫≠t kh·∫©u users

### 2. Nh√† s·∫£n xu·∫•t (Manufacturer)
- Qu·∫£n l√Ω l√¥ thu·ªëc
- Ghi th√¥ng tin l√™n blockchain
- T·∫°o m√£ QR cho thu·ªëc

### 3. Nh√† ph√¢n ph·ªëi (Distributor)
- C·∫≠p nh·∫≠t tr·∫°ng th√°i v·∫≠n chuy·ªÉn
- Qu·∫£n l√Ω kho h√†ng
- X√°c nh·∫≠n giao nh·∫≠n

### 4. B·ªánh vi·ªán (Hospital)
- Qu·∫£n l√Ω kho thu·ªëc
- C·∫•p ph√°t thu·ªëc cho b·ªánh nh√¢n
- X√°c nh·∫≠n nh·∫≠n h√†ng

### 5. B·ªánh nh√¢n (Patient)
- Qu√©t m√£ QR tra c·ª©u ngu·ªìn g·ªëc
- Xem th√¥ng tin thu·ªëc
- ƒê√°nh gi√° ch·∫•t l∆∞·ª£ng

## T√†i kho·∫£n m·∫∑c ƒë·ªãnh cho demo

Sau khi kh·ªüi ƒë·ªông server, t·∫°o t√†i kho·∫£n m·∫∑c ƒë·ªãnh:
```bash
POST /api/auth/create-default-accounts
Authorization: Bearer <admin_token>
```

T√†i kho·∫£n m·∫∑c ƒë·ªãnh:
- **Admin**: username: `admin`, password: `default123`
- **Manufacturer**: username: `manufacturer1`, password: `default123`
- **Distributor**: username: `distributor1`, password: `default123`
- **Hospital**: username: `hospital1`, password: `default123`
- **Patient**: username: `patient1`, password: `default123`

## B·∫£o m·∫≠t

### 1. M√£ h√≥a m·∫≠t kh·∫©u
- S·ª≠ d·ª•ng bcrypt v·ªõi salt rounds = 12
- M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c l∆∞u d·∫°ng plain text

### 2. JWT Authentication
- Token c√≥ th·ªùi h·∫°n 7 ng√†y
- Refresh token (s·∫Ω implement sau)

### 3. Rate Limiting
- Gi·ªõi h·∫°n s·ªë request t·ª´ 1 IP
- Ch·ªëng brute force attack

### 4. Account Locking
- Kh√≥a t√†i kho·∫£n sau 5 l·∫ßn ƒëƒÉng nh·∫≠p sai
- Th·ªùi gian kh√≥a: 2 gi·ªù

### 5. Input Validation
- S·ª≠ d·ª•ng Joi ƒë·ªÉ validate input
- Sanitize d·ªØ li·ªáu tr∆∞·ªõc khi l∆∞u

### 6. B√°o c√°o Security Audit

- Xem file `SECURITY_AUDIT.md` ƒë·ªÉ bi·∫øt chi ti·∫øt:
  - K·∫øt qu·∫£ r√† so√°t ph√¢n quy·ªÅn backend/frontend.
  - ƒê√°nh gi√° c√°c l·ªó h·ªïng ph·ªï bi·∫øn (Injection, XSS, CSRF, IDOR, misconfiguration).
  - Chi·∫øn l∆∞·ª£c qu·∫£n l√Ω secrets (.env, HSM, private key blockchain).
  - K·∫øt qu·∫£ `npm run audit` v√† k·∫ø ho·∫°ch n√¢ng c·∫•p dependencies trong giai ƒëo·∫°n tri·ªÉn khai th·ª±c t·∫ø.

## Testing

### 1. Health Check
```bash
curl http://localhost:5000/api/health
```

### 2. ƒêƒÉng nh·∫≠p
```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "identifier": "admin",
    "password": "default123"
  }'
```

### 3. L·∫•y th√¥ng tin user
```bash
curl -X GET http://localhost:5000/api/auth/me \
  -H "Authorization: Bearer <your_token>"
```

## Checklist tr∆∞·ªõc khi release

Tr∆∞·ªõc m·ªói l·∫ßn release phi√™n b·∫£n m·ªõi, n√™n ki·ªÉm tra nhanh:

- [ ] Backend ch·∫°y ·ªïn ƒë·ªãnh, `GET /api/health` tr·∫£ v·ªÅ `success: true`
- [ ] Frontend build th√†nh c√¥ng, c√°c trang ch√≠nh (Dashboard, Drugs, Supply Chain, QR Scanner, Settings) kh√¥ng l·ªói JavaScript
- [ ] ƒê√£ c·∫•u h√¨nh ƒë√∫ng `.env` cho m√¥i tr∆∞·ªùng deploy (MongoDB, JWT, Blockchain, HSM, CORS, ALLOWED_ORIGINS)
- [ ] ƒê√£ ch·∫°y `npm run audit` v√† ghi nh·∫≠n k·∫øt qu·∫£ (kh√¥ng c√≤n l·ªó h·ªïng nghi√™m tr·ªçng trong dependencies ch√≠nh c·ªßa backend/frontend)
- [ ] Smart contract ƒë√£ deploy ƒë√∫ng network, `CONTRACT_ADDRESS_*` ƒë∆∞·ª£c c·∫≠p nh·∫≠t
- [ ] T·ªëi thi·ªÉu 1‚Äì2 lu·ªìng nghi·ªáp v·ª• ch√≠nh ƒë√£ test l·∫°i: ƒëƒÉng nh·∫≠p, t·∫°o l√¥ thu·ªëc, ghi l√™n blockchain, qu√©t QR/verify

## C√¥ng ngh·ªá s·ª≠ d·ª•ng

### Backend
- **Node.js** - Runtime environment
- **Express.js** - Web framework
- **MongoDB** - Database
- **Mongoose** - ODM
- **JWT** - Authentication
- **bcrypt** - Password hashing
- **Joi** - Input validation

### Security
- **Helmet** - Security headers
- **CORS** - Cross-origin resource sharing
- **Morgan** - HTTP logging
- **Compression** - Response compression

## üìä Tr·∫°ng th√°i d·ª± √°n

### ‚úÖ ƒê√£ ho√†n th√†nh
- [x] Authentication & Authorization v·ªõi JWT
- [x] User Management v·ªõi ph√¢n quy·ªÅn
- [x] Drug Management (Qu·∫£n l√Ω l√¥ thu·ªëc)
- [x] Supply Chain Tracking (Theo d√µi chu·ªói cung ·ª©ng)
- [x] Digital Signatures (Ch·ªØ k√Ω s·ªë theo chu·∫©n VNCA)
- [x] Trust Score System (H·ªá th·ªëng ƒëi·ªÉm t√≠n nhi·ªám)
- [x] Reviews & Ratings (ƒê√°nh gi√° v√† x·∫øp h·∫°ng)
- [x] Tasks Management (Qu·∫£n l√Ω nhi·ªám v·ª•)
- [x] Notifications (Th√¥ng b√°o)
- [x] Reports & Analytics (B√°o c√°o v√† ph√¢n t√≠ch)
- [x] QR Code Scanner (Qu√©t m√£ QR)
- [x] Blockchain Integration c∆° b·∫£n
- [x] Frontend React v·ªõi UI/UX hi·ªán ƒë·∫°i

### üîÑ ƒêang ph√°t tri·ªÉn
- [ ] Performance Optimization
- [ ] Comprehensive Testing
- [ ] Security Audit
- [x] Documentation ho√†n ch·ªânh ‚úÖ

### üìù Xem chi ti·∫øt
Xem **[ROADMAP.md](./ROADMAP.md)** ƒë·ªÉ bi·∫øt chi ti·∫øt v·ªÅ h∆∞·ªõng ph√°t tri·ªÉn v√† k·∫ø ho·∫°ch d√†i h·∫°n c·ªßa d·ª± √°n.

## ƒê√≥ng g√≥p

1. Fork repository
2. T·∫°o feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. T·∫°o Pull Request

## License

Distributed under the MIT License. See `LICENSE` for more information.

## Li√™n h·ªá

- Email: your-email@example.com
- Project Link: [https://github.com/yourusername/drug-traceability-blockchain](https://github.com/yourusername/drug-traceability-blockchain)
